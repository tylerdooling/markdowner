#wrapper
  .container-fluid
    .row-fluid
      .span6
        #editor some text
      .span6
        #document
          %div

%script{:charset => "utf-8", :src => "http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js", :type => "text/javascript"}
%script{:charset => "utf-8", :src => "/js/showdown.js", :type => "text/javascript"}
%script{:charset => "utf-8", :src => "/js/ace.js", :type => "text/javascript"}
%script{:charset => "utf-8", :src => "/js/keybinding-vim.js", :type => "text/javascript"}
%script{:charset => "utf-8", :src => "/js/mode-markdown.js", :type => "text/javascript"}

:javascript
  $(document).ready(function(){
    var editor = ace.edit("editor");
    var markdownMode = require("ace/mode/markdown").Mode;
    editor.getSession().setMode(new markdownMode());

    editor.setTheme("ace/theme/twilight");

    var callback = function(){
      var converter = new Showdown.converter();
      var txt = editor.getSession().getValue();
      var html = converter.makeHtml(txt);
      $("#document div").html(html)
      $("#document div").val(html.replace(/>/g, ">\n").replace(/</g, "\n<").replace(/\n{2,}/g, "\n\n"));

      $('#editor').height($('#document').height() + 40);
      editor.resize();
    }



    editor.getSession().on('change', callback);
  });

